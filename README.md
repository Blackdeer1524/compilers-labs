# 1 Цель работы

Целью данной работы является получение навыков выполнения семантического анализа.

# 2 Исходные данные

В данной работе требуется развить анализирующую часть компилятора, разработанную в лабораторной работе 2.2, 2.4 или 3.2, добавив в неё фазу семантического анализа.

Семантический анализ должен быть выполнен в соответствии с лекцией № 6: в узлы синтаксического дерева, соответствующим некоторым областям видимости, нужно добавить локальные таблицы символов (см. слайды лекции).

Описание входного языка и семантические ограничения, которые нужно в нём проверить, описанны в индивидуальном варианте.

## 2.1 Индивидуальный вариант

Функциональный язык программирования с алгебраическими типами данных

```
<< Объявления типов >>
type List: Cons Int List | Nil.
type Pair: Pair Int Int.
type PairList: PCons Pair PairList | PNil.
type ListList: XCons List ListList | XNil.

<< Объединение двух списков >>
fun (zip List List) -> PairList:

(zip [Cons x xs] [Cons x xs]) -> [PCons [Pair x y] (zip xs ys)] |
(zip xs ys) -> [PNil].

<< Декартово произведение >>
fun (cart_prod List List) -> PairList:

(cart_prod [Cons x xs] ys) -> (append (bind x ys) (cart_prod xs ys)) |
(cart_prod [Nil]) -> PNil.

fun (bind Int List) -> PairList:

(bind x [Cons y ys]) -> [PCons [Pair x y] (bind x ys)] |
(bind x [Nil]) -> [PNil].

<< Конкатенация списков пар >>

fun (append PairList PairList) -> PairList:

(append [PCons x xs] ys) -> [PCons x (append xs ys)] |
(append [PNil] ys) -> ys.

<< Расплющивание вложенного списка >>
fun (flat ListList) -> List:

(flat [XCons [Cons x xs] xss]) -> [Cons x (flat [XCons xs xss])] |
(flat [XCons [Nil] xss]) -> (flat xss) |
(flat [XNil]) -> [Nil].

<< Сумма элементов списка >>
fun (sum List) -> Int:

(sum [Cons x xs]) -> (add x (sum xs)) |
(sum [Nil]) -> 0.

<< Вычисление полинома по схеме Горнера >>
fun (polynom Int List) -> Int:

(polynom x [Nil]) -> 0 |
(polynom x [Cons coef coefs]) -> (add (mul (polynom x coefs) x) coef).

<< Вычисление полинома x³+x²+x+1 >>
fun (polynom1111 Int) -> Int:

(polynom1111 x) -> (polynom x [Cons 1 [Cons 1 [Cons 1 [Cons 1 [Nil]]]]]).
```

В образце есть семантические ошибки.
Семантический анализ

- В программе не может быть определено двух типов с одинаковыми именами.
- В программе не может быть определено двух конструкторов с одинаковыми именами.
- В программе не может быть определено двух функций с одинаковыми именами.
- Имя функции в заголовке и альтернативах должно быть одним и тем же.
- Число и типы аргументов в сигнатуре функции должно совпадать с числом и типами аргументов в каждом из образцов.
- В образцах не может быть одноимённых переменных.
- Образец и правая часть должны соответствовать заявленному типу.
- Тип формального и фактического параметров в вызовах функций совпадает.

# 3 Задание

Выполнение лабораторной работы состоит из следующих этапов:

- Дополнение абстрактного синтаксического дерева служебной информацией (типы выражений, координаты для потенциально ошибочных конструкций).
- Расширение парсера для сохранения координат в синтаксическом дереве.
- Реализация классов исключений для семантических ошибок.
- Реализация семантической проверки как методов узлов семантического дерева.

Для корректных входных данных должно выводиться сообщение «Программа корректна», для некорректных — выдача координаты и описания первой семантической ошибки.
